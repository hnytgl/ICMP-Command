# ICMP-Command
这是一个基于ICMP协议的命令执行系统，允许通过ICMP数据包在客户端和服务器之间执行命令。

## 功能特点

- ✅ 基于ICMP协议的命令传输
- ✅ 支持Windows和Linux系统
- ✅ 使用自定义ICMP类型(30)避免与标准ICMP冲突
- ✅ 支持交互式命令行界面
- ✅ 管理员权限要求（原始套接字）

## 文件说明

- `win_ser.py` - ICMP命令服务器
- `win_client.py` - ICMP命令客户端  
- `test_icmp.py` - 功能测试脚本
- `README.md` - 使用说明文档

## 安装要求

- Python 3.6+
- 管理员/root权限（用于原始套接字）
- 网络连通性

## 使用方法

### 1. 启动服务器

```bash
# 以管理员权限运行
python win_ser.py
```

服务器将监听ICMP数据包并等待客户端连接。

### 2. 启动客户端

```bash
# 以管理员权限运行
python win_client.py <服务器IP>
```

例如连接到本地服务器：
```bash
python win_ser.py 127.0.0.1
```

### 3. 执行命令

在客户端交互界面中输入命令：
```
ICMP> whoami
ICMP> ipconfig
ICMP> echo Hello World
ICMP> exit
```

## 技术细节

### ICMP包格式
- 类型: 30 (自定义类型)
- 代码: 0
- 校验和: 自动计算
- 标识符: 进程ID
- 序列号: 递增计数

### Windows特殊处理
- Windows原始套接字接收包含IP头的完整数据包
- 需要跳过IP头解析ICMP数据
- 需要管理员权限创建原始套接字

### 数据编码
- 命令和结果使用UTF-8编码
- 支持错误处理（errors='ignore'）

## 故障排除

### 常见问题

1. **权限错误**
   ```
   请以管理员权限运行此脚本
   ```
   解决方案：以管理员身份运行CMD/PowerShell

2. **防火墙阻止**
   ```
   无法连接到服务器
   ```
   解决方案：检查防火墙设置，允许ICMP流量

3. **网络配置**
   ```
   请求超时
   ```
   解决方案：检查网络连通性，确保服务器IP正确

### 调试模式

启用详细日志输出：
```python
# 在代码中修改打印级别
print(f"详细调试信息")
```

## 安全注意事项

⚠️ **重要安全提示** ⚠️

1. 此工具使用原始套接字，需要高级权限
2. ICMP协议可能被防火墙/安全设备阻止
3. 在生产环境中使用前进行充分测试
4. 仅在内网或受信任环境中使用

## 许可证

MIT License - 详见LICENSE文件

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

